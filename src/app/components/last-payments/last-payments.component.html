<div>
  <h1>Posljednje uplate</h1>
  <p-button
    (click)="openDialog()"
    icon="pi pi-external-link"
    label="Dodaj uplatu"
    [loading]="(users$ | async) === null"
  ></p-button>
  <p-button
    (click)="loadPayments()"
    icon="pi pi-sync"
    styleClass="p-button-secondary"
  ></p-button>
</div>

<p-dialog
  header="Dodaj uplatu"
  [(visible)]="displayDialog"
  [modal]="true"
  (onHide)="formGroup.reset()"
>

  <form [formGroup]="formGroup">
       <h5>Korisnik</h5>
       <p-autoComplete
      formControlName="userId"
      [showEmptyMessage]="true"
      (completeMethod)="filterUsers($event)"
      [suggestions]="users || []"
      [dropdown]="true"
      field="username"
      (onSelect)="selectUser($event)"
    >

    </p-autoComplete>


    <h5>Vrijeme</h5>
    <p-calendar
      formControlName="time"
      [showTime]="true"
      [readonlyInput]="true"
      [touchUI]="true"
      [dateFormat]="'dd.mm.yy'"
      [appendTo]="'body'"
    ></p-calendar>

    <h5>Iznos</h5>
    <p-inputNumber
      formControlName="amount"
      currency="HRK"
      locale="de-DE"
      mode="currency"
    ></p-inputNumber>

    <h5>Opis</h5>
    <textarea pInputTextarea formControlName="description"></textarea>

  </form>

  <ng-template pTemplate="footer">
    <p-button
      [disabled]="!formGroup.valid"
      icon="pi pi-plus"
      (click)="createPayment()"
      label="Kreiraj"
    ></p-button>
  </ng-template>
</p-dialog>


<!-- Grid -->
<div class="grid grid-nogutter" *ngIf="allPayments$ | async as payments">

  <div *ngFor="let payment of payments" class="col">
    <p-card
      header="{{ payment.user }}"
      styleClass="p-card-shadow"
      subheader="{{ payment.time }}"
    >
      <ng-template pTemplate="header">
        <img alt="Card"
             onerror="this.src='https://hungarytoday.hu/wp-content/uploads/2021/04/hide-the-pain-harold.jpg';this.onerror='';"
             src="{{ payment.picture }}"/>
      </ng-template>
      <div>
        <h4>Iznos</h4>
        {{ payment.amount }}
        <h4>Opis</h4>
        {{ payment.description }}
      </div>

      <ng-template pTemplate="footer">
        <p-button
          (click)="deleteClick(payment.id)"
          icon="pi pi-trash"
          styleClass="p-button-danger"
        >
        </p-button>
        <p-button
          styleClass="p-button-success"
          label="Uredi"
          icon="pi pi-pencil"
          (click)="editPayment(payment.id)"
        >
        </p-button>
      </ng-template>
    </p-card>
  </div>
</div>

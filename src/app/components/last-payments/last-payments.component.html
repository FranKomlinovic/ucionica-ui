<div>
  <p-button
    (click)="openDialog()"
    icon="pi pi-external-link"
    label="Dodaj uplatu"
    [loading]="(users$ | async) === null"
  ></p-button>
  <p-button
    (click)="loadPayments()"
    icon="pi pi-sync"
    styleClass="p-button-secondary"
  ></p-button>
</div>

<p-dialog
  header="Dodaj uplatu"
  [(visible)]="displayDialog"
  [modal]="true"
  (onHide)="formGroup.reset()"
>

  <form [formGroup]="formGroup">
       <h5>Korisnik</h5>
       <p-autoComplete
      formControlName="userId"
      [showEmptyMessage]="true"
      (completeMethod)="filterUsers($event)"
      [suggestions]="users || []"
      [dropdown]="true"
      field="username"
      (onSelect)="selectUser($event)"
    >

    </p-autoComplete>


    <h5>Vrijeme</h5>
    <p-calendar
      formControlName="time"
      [showTime]="true"
      [readonlyInput]="true"
      [touchUI]="true"
      [dateFormat]="'dd.mm.yy'"
      [appendTo]="'body'"
    ></p-calendar>

    <h5>Iznos</h5>
    <p-inputNumber
      formControlName="amount"
      currency="HRK"
      locale="de-DE"
      mode="currency"
    ></p-inputNumber>

    <h5>Opis</h5>
    <textarea pInputTextarea formControlName="description"></textarea>

  </form>

  <ng-template pTemplate="footer">
    <p-button
      [disabled]="!formGroup.valid"
      icon="pi pi-plus"
      (click)="createPayment()"
      label="Kreiraj"
    ></p-button>
  </ng-template>
</p-dialog>


<!-- Grid -->
<div class="grid grid-nogutter" *ngIf="allPayments$ | async as payments; else paymentsLoader">
    <app-last-payment-card class="col" *ngFor="let payment of payments" [payment]="payment" (deleteClicked)="deleteClick($event)" (editClicked)="editPayment($event)"></app-last-payment-card>
  </div>

<ng-template #paymentsLoader>
  <div class="grid grid-nogutter">
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
  <app-last-payment-card class="col"></app-last-payment-card>
</div>
</ng-template>

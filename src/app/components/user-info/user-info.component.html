<div class="grid grid-nogutter" *ngIf="userDetails$ | async as details">
  <div class="col">
    <p-card
      header="{{ details.username }}"
      styleClass="p-card-shadow"
      subheader="Stanje: {{ details.balance }}"
    >
      <ng-template pTemplate="header">
        <img
          alt="Card"
          onerror="this.src='https://hungarytoday.hu/wp-content/uploads/2021/04/hide-the-pain-harold.jpg';this.onerror='';"
          src="{{ details.picture }}"
        />
        <p-fileUpload [chooseIcon]="'pi pi-upload'" mode="basic" [customUpload]="true" (uploadHandler)="upload($event)"
                      accept="image/*" [maxFileSize]=2000000 [auto]="true" chooseLabel="Promijeni sliku"></p-fileUpload>

      </ng-template>
      <div>
        <h4>Ukupno vrijeme provedeno:</h4>
        {{ details.timeSpent }}
        <h4>Trajanje prosje훾nog djestva:</h4>
        {{ details.averageTimeSpent }}
        <h4>Cijena prosje훾nog djestva:</h4>
        {{ details.averageStayPrice }}
        <h4>Ukupna cijena dejstva:</h4>
        {{ details.totalStayPrice }}
        <h4>Ukupne uplate:</h4>
        {{ details.totalPayments }}
      </div>

      <div *ngIf="!readOnly">
        <h5 *ngIf="!details.currentlyActive">Jeste li u u훾ionici?</h5>
        <p-button
          (click)="confirmStay()"
          *ngIf="!details.currentlyActive"
          label="Prijavi dolazak"
          styleClass="p-button"
        >
        </p-button>
        <p-button
          (click)="confirmStay()"
          *ngIf="details.currentlyActive"
          label="Odjavi se"
          styleClass="p-button-danger"
        >
        </p-button>
      </div>
      <h5 *ngIf="details.currentlyActive">Trenutno ste u u훾ionici</h5>
    </p-card>
  </div>
</div>

<div *ngIf="!readOnly">
  <h1>Eventi</h1>
  <div class="grid grid-nogutter" *ngIf="userEvents$ | async as events">
    <div *ngFor="let event of events" class="col">
      <p-card
        header="{{ event.currentEvent ? '[UPRAVO] ' + event.name : event.name }}"
        styleClass="p-card-shadow"
        subheader="{{ event.date + ' u ' + event.startTime }}"
      >
        <ng-template pTemplate="header">
          <img alt="Card"
               onerror="this.src='https://hungarytoday.hu/wp-content/uploads/2021/04/hide-the-pain-harold.jpg';this.onerror='';"
               src="{{ event.picture }}"/>
        </ng-template>
        <div>
          <p *ngIf="event.currentEvent">TRENUTNO SE DEJSTVUJE</p>
          <p>Opis:</p>
          {{ event.description }}
          <p>Vrijeme:</p>
          {{ event.startTime }} - {{ event.endTime }}
          <p>Pozvani su:</p>
          {{ event.users }}
        </div>
      </p-card>
    </div>
  </div>
</div>

<p-tabView>
  <p-tabPanel header="Moja dejstva">
    <h3>Dejstva</h3>
    <p-accordion [style]="{ width: '250px' }">
      <div *ngFor="let stay of (userDetails$ | async)?.stays">
        <p-accordionTab header="{{ stay.date }}">
          <h4>Vrijeme</h4>
          <p>{{ stay.startTime }} - {{ stay.endTime }}</p>
          <h4>Cijena</h4>
          <p>{{ stay.price }}</p>
        </p-accordionTab>
      </div>
    </p-accordion>
  </p-tabPanel>
  <p-tabPanel header="Moje uplate">
    <h3>Uplate</h3>
    <p-accordion [style]="{ width: '250px' }">
      <div *ngFor="let payment of (userDetails$ | async)?.payments">
        <p-accordionTab header="{{ payment.date }}">
          <h4>Vrijeme</h4>
          <p>{{ payment.time }}</p>
          <h4>Uplata</h4>
          <p>{{ payment.amount }}</p>
        </p-accordionTab>
      </div>
    </p-accordion>
  </p-tabPanel>
</p-tabView>


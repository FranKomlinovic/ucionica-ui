<div>
  <h1>Trenutni dejstvenici</h1>

  <!-- Open form button -->
  <p-button
    (click)="openDialog()"
    *ngIf="admin"
    icon="pi pi-external-link"
    label="Evidentiraj dolazak"
  ></p-button>
  <p-button
    (click)="confirmEndAllStays()"
    *ngIf="admin"
    label="ZavrÅ¡i dejstvo"
    styleClass="p-button-danger"
  ></p-button>

  <h2>
    Broj dejstvenika: {{ numberOfStays }}
    <p-button
      (click)="getAllStays()"
      *ngIf="admin"
      icon="pi pi-sync"
      styleClass="p-button-secondary"
    ></p-button>
  </h2>
</div>
<!-- Dialog -->
<p-dialog [(visible)]="displayDialog" header="Dodaj dejstvo">
  <h5>Korisnik</h5>
  <p-multiSelect
    [(ngModel)]="selectedUserAdvanced"
    [filter]="true"
    [itemSize]="34"
    [options]="users"
    [showToggleAll]="false"
    [virtualScroll]="true"
    class="multiselect-custom-virtual-scroll"
    optionLabel="username"
  >
    <ng-template let-user pTemplate="item">
      <div class="country-item">
        <div>{{ user.username }}</div>
      </div>
    </ng-template>
  </p-multiSelect>
  <h5>Datum</h5>
  <p-calendar [(ngModel)]="date" dateFormat="dd.mm.yy"></p-calendar>

  <h5>Vrijeme</h5>
  <p-calendar [(ngModel)]="time" [timeOnly]="true"></p-calendar>

  <ng-template pTemplate="footer">
    <p-button (click)="saveStay()" icon="pi pi-plus" label="Kreiraj"></p-button>
  </ng-template>
</p-dialog>

<!-- Grid -->
<div class="grid grid-nogutter">
  <div *ngFor="let stay of currentStays" class="col">
    <p-card
      header="{{ stay.user }}"
      styleClass="p-card-shadow"
      subheader="{{ stay.startTime }}"
    >
      <ng-template pTemplate="header" style="width: 100%; height: 40%">
        <img
          [style]="{
            width: '270px',
            height: '270px',
            'object-fit': 'cover'
          }"
          alt="Card"
          src="{{ stay.picture }}"
        />
      </ng-template>
      <div>
        {{ stay.balance }}
      </div>
      <ng-template pTemplate="footer">
        <p-button
          (click)="confirmEndStay(stay.userId)"
          *ngIf="admin"
          label="Odjavi"
          styleClass="p-button-secondary"
        >
        </p-button>
        <p-button
          (click)="showInfo(stay.userId)"
          *ngIf="admin"
          class="m-3"
          label="Info"
          styleClass="p-button-primary"
        >
        </p-button>
      </ng-template>
    </p-card>
  </div>
</div>

<p-dialog
  [(visible)]="showDialog"
  [baseZIndex]="10000"
  [style]="{ width: '320px' }"
  header="Informacije o dejstveniku"
>
  <div *ngIf="showDialog">
    <app-user-info
      [showButton]="false"
      [userId]="selectedUserId"
    ></app-user-info>
  </div>
</p-dialog>

<app-spinner [visible]="spinnerOn"></app-spinner>

<div>
    <h1>Trenutni dejstvenici</h1>

    <!-- Open form button -->
    <p-button
        *ngIf="admin"
        (click)="openDialog()"
        icon="pi pi-external-link"
        label="Evidentiraj dolazak"
    ></p-button>
    <p-button
        *ngIf="admin"
        style="margin-left: 3px"
        styleClass="p-button-danger"
        label="ZavrÅ¡i dejstvo"
        (click)="confirmEndAllStays()"
    ></p-button>

    <h2>
        Broj dejstvenika: {{ numberOfStays }}
        <p-button
            *ngIf="admin"
            icon="pi pi-sync"
            styleClass="p-button-secondary"
            (click)="getAllStays()"
        ></p-button>
    </h2>
</div>
<!-- Dialog -->
<p-dialog header="Dodaj dejstvo" [(visible)]="displayDialog">
    <h5>Korisnik</h5>
    <p-multiSelect
        [options]="users"
        [showToggleAll]="false"
        [(ngModel)]="selectedUserAdvanced"
        optionLabel="username"
        [virtualScroll]="true"
        [filter]="true"
        [itemSize]="34"
        class="multiselect-custom-virtual-scroll"
    >
        <ng-template let-user pTemplate="item">
            <div class="country-item">
                <div>{{ user.username }}</div>
            </div>
        </ng-template>
    </p-multiSelect>
    <h5>Datum</h5>
    <p-calendar [(ngModel)]="date" dateFormat="dd.mm.yy"></p-calendar>

    <h5>Vrijeme</h5>
    <p-calendar [(ngModel)]="time" [timeOnly]="true"></p-calendar>

    <ng-template pTemplate="footer">
        <p-button
            icon="pi pi-plus"
            (click)="saveStay()"
            label="Kreiraj"
        ></p-button>
    </ng-template>
</p-dialog>

<!-- Grid -->
<div class="grid grid-nogutter">
    <div *ngFor="let stay of currentStays">
        <div class="col flex align-items-center justify-content-center m-3">
            <p-card
                header="{{ stay.user }}"
                subheader="{{ stay.startTime }}"
                [style]="{ width: '230px' }"
                styleClass="p-card-shadow"
            >
                <ng-template
                    pTemplate="header"
                    style="width: 100%; height: 40%"
                >
                    <img
                        [style]="{
                            width: '270px',
                            height: '270px',
                            'object-fit': 'cover'
                        }"
                        alt="Card"
                        src="{{ stay.picture }}"
                    />
                </ng-template>
                <div>
                    {{ stay.balance }}
                </div>
                <p-confirmDialog></p-confirmDialog>
                <ng-template pTemplate="footer">
                    <p-button
                        *ngIf="admin"
                        styleClass="p-button-secondary"
                        label="Odjavi"
                        (click)="confirmEndStay(stay.userId)"
                    >
                    </p-button>
                    <p-button
                        *ngIf="admin"
                        styleClass="p-button-primary"
                        label="Info"
                        (click)="showInfo(stay.userId)"
                        class="m-3"
                    >
                    </p-button>
                </ng-template>
            </p-card>
        </div>
    </div>
</div>

<p-dialog
    header="Informacije o dejstveniku"
    [(visible)]="showDialog"
    [style]="{ width: '320px' }"
    [baseZIndex]="10000"
>
    <div *ngIf="showDialog">
        <app-user-info
            [userId]="selectedUserId"
            [showButton]="false"
        ></app-user-info>
    </div>
</p-dialog>

<div>
	<!-- Open form button -->
	<p-button
		(click)="openDialog()"
		icon="pi pi-external-link"
		label="Kreiraj event"
		[loading]="(users$ | async) === null"
	></p-button>

	<p-button
		icon="pi pi-sync"
		styleClass="p-button-secondary"
		(click)="loadEvents()"
	></p-button>
</div>

<!-- Dialog -->
<p-dialog
	header="Kreiraj event"
	[(visible)]="displayDialog"
	[modal]="true"
	(onHide)="formGroup.reset()"
>
	<form [formGroup]="formGroup">
		<h5>Naziv</h5>
		<input type="text" pInputText formControlName="name" />

		<h5>Opis</h5>
		<textarea pInputTextarea formControlName="description"></textarea>

		<h5>Link slike</h5>
		<input type="text" pInputText formControlName="picture" />

		<h5>Korisnik</h5>
		<p-multiSelect
			[options]="(users$ | async) || []"
			[showToggleAll]="false"
			formControlName="users"
			optionLabel="username"
			optionValue="id"
			display="chip"
			[filter]="true"
			[autofocusFilter]="true"
			[appendTo]="'body'"
		>
			<ng-template let-user pTemplate="item">
				<div>
					<div>{{ user.username }}</div>
				</div>
			</ng-template>
		</p-multiSelect>

		<h5>Početak</h5>
		<p-calendar
			formControlName="startTime"
			[showTime]="true"
			[readonlyInput]="true"
			[touchUI]="true"
			[dateFormat]="'dd.mm.yy'"
			[appendTo]="'body'"
			[minDate]="today"
		></p-calendar>

		<h5>Kraj</h5>
		<p-calendar
			formControlName="endTime"
			[showTime]="true"
			[readonlyInput]="true"
			[touchUI]="true"
			[dateFormat]="'dd.mm.yy'"
			[appendTo]="'body'"
			[minDate]="today"
		></p-calendar>
	</form>

	<ng-template pTemplate="footer">
		<p-button
			[disabled]="!formGroup.valid"
			icon="pi pi-plus"
			(click)="createEvent()"
			label="Kreiraj"
		></p-button>
	</ng-template>
</p-dialog>

<!-- Grid -->
<div class="grid grid-nogutter" *ngIf="allEvents$ | async as events; else eventsLoading">
	<app-event-card class="col" *ngFor="let event of events" [event]="event" (editClicked)="editEvent($event)" (deleteClicked)="deleteClick($event)"></app-event-card>
</div>

<ng-template #eventsLoading>
	<div class="grid grid-nogutter">
	<app-event-card class="col"></app-event-card>
	<app-event-card class="col"></app-event-card>
	<app-event-card class="col"></app-event-card>
	<app-event-card class="col"></app-event-card>
	</div>
</ng-template>
